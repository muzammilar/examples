# Hello PostgreSQL

Installs and configure a PostgreSQL-HA cluster using Helm charts.

#### Developmement/Updates

```sh
# create chart if it doesn't exist
helm create hello-postgres # already ran and then modified
# The contents of the `templates` directory were generated by it

# download and update the dependency chart
helm dependency update ./charts

# Check diff
git diff --no-pager --color --exit-codes
```

#### Installation

```sh
export NAMESPACE="test-namepsace"
export RELEASE_NAME="release"
export POSTGRES_PASS_POSTGRES_USER="fakepass"  # password only for demo, should be secured using secrets
export POSTGRES_PASS_REPMGR="repmgrpass"  # password only for demo, should be secured using secrets
export POSTGRES_PASS_APP_USER="userpass"
export POSTGRES_PASS_PGPOOL_ADMIN="userpass"

helm upgrade --debug --install  \
   --create-namespace --namespace ${NAMESPACE} ${RELEASE_NAME} ./charts \
   --values deploy/values-dev.yml \
   --set image.tag=0.0.1 \
   --set postgresql-ha.postgresql.password="${POSTGRES_PASS_APP_USER}" \
   --set postgresql-ha.postgresql.postgresPassword="${POSTGRES_PASS_POSTGRES_USER}" \
   --set postgresql-ha.postgresql.repmgrPassword="${POSTGRES_PASS_REPMGR_USER}" \
   --set postgresql-ha.pgpool.adminPassword="${POSTGRES_PASS_PGPOOL_ADMIN}" \
   --set myapp.postgres.host="${RELEASE_NAME}-postgresql-ha-pgpool"
```
